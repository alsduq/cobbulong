<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="member">
 	<select id="selectId" parameterType="hashmap" resultType="int">
	    <![CDATA[
	        SELECT
	            count(*)
	        FROM
	            tb_member
	        WHERE
	            id = #{inputId} AND del_gb = 'N'
	    ]]>
	</select>
	
	<select id="insertMember" parameterType="hashmap" resultType="int">
			{ CALL study.SP_INSERT_MEMBER(#{inputId}, #{inputEmail}, #{inputPassword1}, #{inputName}, @O_Result)}
	</select>
	
	<select id="logIn" parameterType="hashmap" resultType="string">
	    <![CDATA[
	        SELECT
	            password
	        FROM
	            tb_member
	        WHERE
	            id = #{inputId} AND del_gb = 'N'
	    ]]>
	</select>
	
	<select id="findId" parameterType="hashmap" resultType="string">
		<![CDATA[
	       SELECT
	           id
	       FROM
	           tb_member
	       WHERE
	           email = #{inputEmail} AND del_gb = 'N'
	    ]]>
	</select>
	
	<select id="confirmAccount" parameterType="hashmap" resultType="int">
		<![CDATA[
	       SELECT
	           count(*)
	       FROM
	           tb_member
	       WHERE
	           id = #{inputId} AND email = #{inputEmail2} AND del_gb = 'N'
	    ]]>
	</select>
	
	<update id="updateAuthNo" parameterType="hashmap">
		<![CDATA[
			UPDATE 
				tb_member
			SET
				auth_no = #{authNum}
			WHERE
				email = #{inputEmail2}	
		]]>
	</update>
	
	<select id="selectAuthNo" parameterType="hashmap" resultType="int">
		<![CDATA[
	       SELECT
	           count(*)
	       FROM
	           tb_member
	       WHERE
	           email = #{inputEmail} AND auth_no = #{inputAuthNo} AND del_gb = 'N'
	    ]]>
	</select>
	
	<update id="updatePassword" parameterType="hashmap">
		<![CDATA[
			UPDATE 
				tb_member
			SET
				password = #{inputPassword}
			WHERE
				id = #{inputId} AND del_gb = 'N'
		]]>
	</update>
	
	<select id="insertLoginLog" parameterType="hashmap" resultType="int">
		{ CALL study.SP_INSERT_LOGIN_LOG(#{inputId}, #{userIp}, @O_Result)}
	</select>
	
	<update id="updateLogOutLog" parameterType="hashmap">
		<![CDATA[
			UPDATE 
				tb_login_log
			SET
				logout_dtm = now()
			WHERE
				user_id = #{inputId} AND idx = (
					SELECT idx FROM (
						SELECT idx FROM tb_login_log WHERE user_id = #{inputId} ORDER BY idx DESC LIMIT 1
					) 
				tmp)
		]]>
	</update>
	
	
</mapper>
