<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="sample">
	<resultMap type="hashmap" id="procResultHashMap"></resultMap>
	<resultMap type="Integer" id="procResultInteger1"></resultMap>
	<resultMap type="Integer" id="procResultInteger2"></resultMap>
	<select id="selectBoardList" parameterType="hashmap" resultMap="procResultHashMap, procResultInteger1, procResultInteger2">
			{ CALL study.SP_BOARDLIST_GET(#{page_idx}, 10, @O_TotalCount, @O_PageIndex)}
	</select>
	
	<insert id="insertBoard" parameterType="hashmap" useGeneratedKeys="true" keyProperty="idx">
		<![CDATA[
			INSERT INTO tb_board
			(
			    title, 
			    contents, 
			    hit_cnt, 
			    del_gb, 
			    crea_dtm, 
			    crea_id
			)
			VALUES
			(
			    #{title}, 
			    #{contents}, 
			    0, 
			    'N', 
			    now(), 
			    #{crea_id}
			)
		]]>
	</insert>
	
	<insert id="insertFile" parameterType="hashmap">
	    <![CDATA[
	        INSERT INTO tb_file
	        (
	            board_idx,
	            original_file_name,
	            stored_file_name,
	            file_size,
	            crea_dtm,
	            crea_id
	        )
	        VALUES
	        (
	            #{board_idx},
	            #{original_file_name},
	            #{stored_file_name},
	            #{file_size},
	            now(),
	            'Admin'
	        )
	    ]]>
	</insert>


	
	<update id="updateHitCnt" parameterType="hashmap">
		<![CDATA[
			UPDATE tb_board 
			SET
				hit_cnt = ifnull(hit_cnt, 0) + 1
			WHERE
				idx = #{idx}	
		]]>
	</update>
	
	<select id="selectBoardDetail" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT
				idx,
				hit_cnt,
				crea_id,
				crea_dtm,
				title,
				contents
			FROM
				tb_board
			WHERE
				idx = #{idx}		
		]]>
	</select>
	
	<update id="updateBoard" parameterType="hashmap">
		<![CDATA[
			UPDATE tb_board
			SET
				title = #{title},
				contents = #{contents}
			WHERE
				idx = #{idx}	
		]]>
	</update>
	
	<update id="deleteBoard" parameterType="hashmap">
		<![CDATA[
			UPDATE tb_board
			SET
				del_gb = 'Y'
			WHERE
				idx = #{idx}
		]]>
	</update>
	
	<select id="selectFileList" parameterType="hashmap" resultType="hashmap">
	    <![CDATA[
	        SELECT
	            idx,
	            original_file_name,
	            round(file_size/1024,1) AS file_size
	        FROM
	            tb_file
	        WHERE
	            board_idx = #{idx}
	            AND del_gb = 'N'
	    ]]>
	</select>
	
	<insert id="insertComment" parameterType="hashmap" useGeneratedKeys="true" keyProperty="idx">
		<![CDATA[
			INSERT INTO tb_comment
			(
				parent_idx,
				board_idx,
				contents,
				crea_id,
				crea_dtm,
				del_gb
			)
			VALUES
			(
				#{parent_idx},
				#{board_idx},
				#{contents},
				#{crea_id},
				now(),
				'N'
			)
		]]>
	</insert>
	
	<update id="updateComment" parameterType="hashmap">
		<![CDATA[
			UPDATE tb_comment
			SET
				contents = #{contents}
			WHERE
				idx = #{idx}
		]]>
	</update>
	
	<select id="selectCommentList" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT
			    idx,
			    parent_idx,
			    contents,
			    crea_id,
			    crea_dtm
			FROM
			    tb_comment
			WHERE
				del_gb = 'N' AND board_idx = #{board_idx}
			ORDER BY idx ASC
		]]>
	</select>
	
	<update id="deleteComment" parameterType="hashmap">
		<![CDATA[
			UPDATE tb_comment
			SET
				del_gb = 'Y'
			WHERE
				idx = #{idx}
		]]>
	</update>



</mapper>